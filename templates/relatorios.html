{% extends "base.html" %}
{% block content %}

<!-- Cabeçalho específico para impressão (aparece só no PDF) -->
<div class="only-print mb-3">
  <div class="d-flex align-items-center gap-3">
    <img src="/static/logo-crors.png" alt="CRO/RS" width="64" height="64" onerror="this.style.display='none'">
    <div>
      <h5 class="mb-0">ELEIÇÕES CRORS - 2025</h5>
      <small>Relatórios de ligações</small>
    </div>
  </div>
  <hr>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="m-0">Relatórios e Gráficos</h4>
  <div class="no-print d-flex gap-2">
    <button class="btn btn-outline-secondary" onclick="window.print()">Imprimir / Salvar PDF</button>
    <a class="btn btn-outline-primary" href="/">Voltar ao cadastro</a>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-title">Distribuição por Tipo de Dúvida</h6>
        <canvas id="chartDuvida"></canvas>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-title">Ligações por Dia</h6>
        <canvas id="chartDia"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
async function loadChartDuvida() {
  const res = await fetch('/api/stats/por_duvida');
  const data = await res.json();
  const ctx = document.getElementById('chartDuvida');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.labels,
      datasets: [{ label: 'Quantidade', data: data.counts }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { x: { ticks: { autoSkip: false } }, y: { beginAtZero: true } }
    }
  });
}

async function loadChartDia() {
  const res = await fetch('/api/stats/por_dia');
  const data = await res.json();
  const ctx = document.getElementById('chartDia');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.labels,
      datasets: [{ label: 'Ligações por dia', data: data.counts }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
}

loadChartDuvida();
loadChartDia();
</script>
{% endblock %}
